<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Ether BoxCars</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>

    <!-- Plugin CSS -->
    <link href="vendor/magnific-popup/magnific-popup.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/creative.css" rel="stylesheet">

  </head>

  <body id="page-top">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-default fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="#page-top">BoxCars</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#about">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#algorithm">Algorithm</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#roll_section">Roll History</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#code">Code</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#contact">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <header class="masthead text-center text-black d-flex">
      <div class="container my-auto">
        <div class="row">
          <div class="col-lg-3 mx-auto"> 
		      <h4 align='left'>Key Values</h4>
			  <p align='left'>&nbsp;&nbsp;(in Ether)</p>
			  <table>
			  <tr><td>Player:  </td><td>&nbsp;</td><td id="eth"> </td><td>&Xi;</td></tr>
			  <tr><td>House:   </td><td>&nbsp;</td><td id="house"> </td><td>&Xi;</td></tr>
			  <tr><td>Max Bet: </td><td>&nbsp;</td><td id="max"> </td><td>&Xi;</td></tr>
			  <tr><td>Min Bet: </td><td>&nbsp;</td><td id="min"> </td><td>&Xi;</td></tr>
			  <tr><td>Block: </td><td>&nbsp;</td><td id="block"> </td><td></td></tr>
			  </table>
			  <br>
  		  </div>

          <div class="col-lg-6 mx-auto">
			<div>
	            <h1 class="text-uppercase">
	              <strong>BoxCars</strong>
	            </h1>
	            <hr>
	            <p class="text-faded mb-5">A proof-of-concept multi-round Ethereum dice game <br>- can you roll a double-six in nineteen rolls?</p>
				<div id="bet_div">
					<p> <input type="text" id="bet" placeholder="0.0 &Xi;"/>
			    	<a class="btn btn-primary btn-xl js-scroll-trigger" href="#" onclick="placeBet()">Place Bet</a></p>
				</div>
				<div id="finalize_div">
					<h2 id="current_roll">Roll:</h2>
					<p> <a class="btn btn-primary btn-xl js-scroll-trigger" href="#" onclick="finalizeBet()">Finalize Bet</a></p>
					<p> (You <i>must</i> press 'Finalize Bet' to collect your winnings if you win - the blockchain can't pay out without your input!)</p>
					
				</div>
				<br>
				<br>
				<p style="font-size: small;text-align: justify;">
				<b>Warning</b> - This is a technology test - do not use this site if it is illegal in your jurisdiction.  As this is test code, it will
				only be online for a short time, and may contain errors.  It is intended as a proof of concept to trial some new ways of running
				multi-player, multi-round games on the blockchain, and to test the security of on-chain pseudo-random number generation.
				So keep your 'bets' small, have fun, and let me know if you find any weird things happening...!</p>	
			</div>
		  </div>
		
		  <div class="col-lg-3 mx-auto text-left"> 

			  <div id="roll_summary">
			  	<h4 id="history">72 Recent Rolls:</h4>			  
			  	<p id="rolls" class="dice"></p>
				<p><a href="#roll_section">more...</a></p>
			  </div>
		  </div>
		
        </div>
      </div>
    </header>

    <section class="bg-primary" id="about">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto text-left">
			<h2 class="section-heading text-black">A multi-player, multi-round Ethereum game</h2>
            <hr class="dark my-4">
            <p class="text-faded mb-4">This is a test website, to try out some ideas to be used for a more complex roleplaying game. The idea is to simulate round-by-round game play on the blockchain, while keeping gas costs low.</p>
			<p class="text-faded mb-4">In the game, the user places their bet, and then over the next 19 blocks the game 'rolls' two dice using the blockhash for randomness - this is free and doesn't require paying any gas.  If the player 'wins', they then cliam their winning (this costs gas).  Because the blockhash is used, the bet must be claimed within 256 blocks of the start - about an hour.</p>
			<p class="text-faded mb-4">This gives us the security of the blockchain, and the excitement of a multi-round game, without paying gas every round.  It also avoids killing the chain with huge numbers of transactions!</p>
			<h3 class="section-heading text-black">Warning!</h3>
			<p class="text-faded mb-4">This is <b>NOT</b> intended to be a serious gambling game!  This is a proof of concept to test a multi-player, multi-turn on-chain game.  Keep your bets small, and do not play at all if it is illegal in your jurisdiction.  The game is on both Ropsten and Mainnet, so you can use Ropsten to avoid using 'real Ether'. 
			The game is 'rigged' so that the betting limit gets smaller and smaller as the house runs out of money; so while the house will never go entirely broke, it may be that the cost of gas will exceed the value of your bet.</p>
            <a class="btn btn-light btn-xl js-scroll-trigger" href="#page-top">Get Started!</a>
          </div>


        </div>
      </div>
    </section>
	
    <section class="bg-dark text-black" id="algorithm">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 mx-auto">
			<h2 class="section-heading text-white text-center">What's the Algo?</h2>
            <hr class="light my-4">
            <p class="text-white">BoxCars is a testbed for inexpensive multi-player, multi-round games.  It does this
            using on chain randomness (the player is betting on future blockhashes), and 'personalises' the game by 
            combining the blockhash with the player address. (This also smooths out the house's losses; otherwise all 
            players would win or lose together).</p>
            <p class="text-white">The core algorithm is in the 'getDiceRoll()' method which takes a particular block :</p>
            <hr class="light my-4">
<pre class='code'>
  function getDiceRoll(uint blockNumber, address player) public view returns (uint8 roll) {
      if (blockNumber + 255 > block.number && blockNumber <= block.number) {
          bytes32 result = keccak256(abi.encodePacked(player, blockhash(blockNumber)));
          return uint8(1+(uint256(result)%36));  
      }
      return 0;  // not valid to ask for rolls more than 255 blocks old...
  }
</pre> 
               <hr class="light my-4">
            <p class="text-white">Since this is a 'view' method, it doesn't require any gas to run.  The web front end
			shows the player each 'roll' as it happens, and the only time the player has to pay gas is after they win,
			when they 'claim' their winnings.  (Or when they place a new bet, in which case they also pay to clean up
			any old ones.)</p>
			
			<p><b>Security</b> Something else that I want to test is security.  There is a lot of concern about using 
			the blockhash for 'randomness'.  In this game though, players are betting on future blockhashes - in theory, 
			it seems a bad miner would need to mine an average of 36 blocks, and discard 35, in order to win.  This would 
			seem to be too expensive to be worth doing (?).</p>

            <a class="btn btn-light btn-xl js-scroll-trigger" href="#page-top">Get Started!</a>
          </div>
        </div>
      </div>
    </section>		

    <section class="bg-primary" id="roll_section">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto text-center">
			<h2 class="section-heading text-black">Roll History</h2>
            <hr class="light my-4">
            <p class="text-faded mb-4 text-left">This is a list of the 144 (e.g. 36 x 4) most recent rolls (assuming you're running metamask or similar).  Note that sometimes the block chain takes a while to reach consensus, which means that the last few blocks should be treated as 'tentative'.  Financial hubs tend to wait for 12 blocks to be processed before declaring a transaction 'final', although for most practical purposes 6 transactions should be enough.</p>
			<p id="roll_history" class="dice"></p> 
          </div>
        </div>
      </div>
    </section>	

    <section id="code">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 mx-auto text-left">
            <h2 class="section-heading">Contract Source Code</h2>
            <hr class="my-4">

			<p>Source code is available at <a href="https://github.com/etherboxcars/BoxCars">github</a>.  Please review it, and comments
			greatfully received either directly or on reddit... (search for 'ether boxcars').</p>

			</pre>
          </div>
        </div>
      </div>
    </section>
	
    <section class="bg-dark text-black" id="contact">
      <div class="container">

        <div class="row">
          
          <div class="col-lg-4 mr-auto text-center">
            <i class="fa fa-envelope-o fa-3x mb-3 sr-contact"></i>
            <p>This is my first 'real' solidity contract, so really interested in feedback about security, design and coding quality issues.
              <a href="mailto:feedback@">boxcars@jxworkbench.com</a>
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
    <script src="vendor/scrollreveal/scrollreveal.min.js"></script>
    <script src="vendor/magnific-popup/jquery.magnific-popup.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/creative.min.js"></script>

	<!-- Ethereum scripts -->
	<script src="web3.js"></script>
	<!--script src="jquery-3.1.1.slim.min.js"></script-->
	<script src="index.js"></script>

  </body>

</html>
